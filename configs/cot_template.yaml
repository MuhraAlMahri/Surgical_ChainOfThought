# Clinical Chain-of-Thought Template for Surgical Vision Analysis
# Hierarchical, question-driven structure based on clinical reasoning flow

system_prompt: "You are an expert surgeon analyzing a surgical image or video frame. Think step-by-step by answering the following questions in sequence. Your reasoning must follow this exact clinical flow."

clinical_reasoning_flow:
  - stage: "Basic Assessment"
    questions:
      - "What is the view and perspective of the image? (e.g., laparoscopic, microscopic, egocentric, ultrasound, endoscopic)"
      - "How is the quality of the image? Is it sufficient for diagnosis? (e.g., clear, blurry, occluded, bloody, well-lit)"

  - stage: "Findings Recognition"
    questions:
      - "What anatomical structures are clearly visible in this surgical field?"
      - "What surgical action or step is being performed at this moment?"
      - "What is the primary finding or abnormality? (e.g., instrument, tissue, bleed, tumor, normal anatomy)"

  - stage: "Localization & Description"
    questions:
      - "Where exactly is the finding located? (Describe anatomically with specific landmarks)"
      - "What are its specific attributes? (e.g., size, shape, color, texture, movement, consistency)"
      - "What specific instruments are present and what is their function in this context?"

  - stage: "Synthesis & Correlation"
    questions:
      - "What does this finding mean in the context of this specific surgical procedure?"
      - "What is the potential cause or clinical implication of this finding?"

  - stage: "Temporal Analysis (if applicable)"
    questions:
      - "How has the scene or anatomy changed from a previous step or image? (if temporal context available)"

  - stage: "Prognosis & Risk"
    questions:
      - "What are the potential risks or complications based on this finding?"
      - "What is the likely immediate next step in the surgical procedure?"

  - stage: "Conclusion & Recommendation"
    questions:
      - "What is your overall assessment and diagnosis?"
      - "What specific advice or recommendation would you give to the surgeon?"

final_instruction: "Based on your sequential reasoning above, provide a concise final summary in the style of a surgical note."

# Few-shot examples for each dataset type
few_shot_examples:
  kvasir_vqa:
    - question: "What is visible in this endoscopic image?"
      answer: |
        **Basic Assessment:**
        - View: Endoscopic view of the gastrointestinal tract
        - Quality: Excellent quality with clear visibility, no occlusions or blur. Rating: 5/5.
        
        **Findings Recognition:**
        - Anatomical structures: Duodenal mucosa with visible villi and normal vascular pattern
        - Surgical action: Diagnostic examination phase during upper endoscopy
        - Primary finding: Normal duodenal mucosa with typical mucosal folds
        
        **Localization & Description:**
        - Location: Duodenal region, specifically the second part of duodenum
        - Attributes: Intact mucosal wall, normal vascular pattern, typical villous architecture
        - Instruments: Endoscope positioned appropriately for mucosal examination
        
        **Synthesis & Correlation:**
        - Clinical context: This is a routine diagnostic endoscopy to assess duodenal mucosa
        - Clinical implication: Normal findings suggest no immediate pathology requiring intervention
        
        **Temporal Analysis:**
        - No previous images available for comparison
        
        **Prognosis & Risk:**
        - Risk: Low risk based on normal appearance
        - Next step: Continue systematic examination of remaining GI tract
        
        **Conclusion & Recommendation:**
        - Assessment: Normal duodenal mucosa
        - Recommendation: Continue with systematic examination or proceed to biopsy if indicated by clinical history
        
        **Surgical Note Summary:** Normal duodenal mucosa visualized with intact wall architecture and typical vascular pattern. No signs of inflammation, bleeding, or other pathology. Continue with systematic examination of remaining gastrointestinal tract.

# Output format specification
output_format:
  structure: "hierarchical_qa"
  include_ratings: true
  include_confidence: false
  max_length_per_question: 150
  include_surgical_note: true
